<div class="flex d-col dayView">
    <app-day-selector
            class="widget noPadding daySelectorFixed"
            [currentValue]="day"
            [options]="daySelectorOptions"
            (onDateChanged)="onDateChanged($event)">
    </app-day-selector>

    <div [hidden]="hasData">
        <div class="card">
            <div class="card-body bg-white">
                <div *ngIf="hasNoDataForToday">
                    <div>
                        <div class="text-center" i18n="@@noDataAvailableForToday">No data available for today</div>
                    </div>
                </div>
                <div *ngIf="!hasNoDataForToday">
                    <div>
                        <div class="text-center">
                            <dx-load-indicator class="text-center"></dx-load-indicator>
                        </div>
                        <p class="text-center saving"><span
                                i18n="@@fetching">Fetching</span><span>.</span><span>.</span><span>.</span></p>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div [hidden]="!hasData">

        <app-day-orders-table
                class="widget"
                style="padding-bottom: 0px;"
                [lastViewed]="drilledOrder"
                [orders]="orders"
                [bdIsCurrentBd]="bdIsCurrentBd"
                [openOrders]="openOrders"
                (onOrderClicked)="onOrderClicked($event)"
        ></app-day-orders-table>


        <div class="widget">
            <div class="flex d-col">
                <div class="title" i18n="@@sales2">Sales</div>
                <div class="flex d-col body">
                    <mat-expansion-panel expanded="true">
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                                <ng-container i18n="@@salesByHour">Sales vs 4week Avg</ng-container>
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                        <app-day-hourly-sales
                                [data]="salesByHour">
                        </app-day-hourly-sales>
                    </mat-expansion-panel>
                    <mat-expansion-panel expanded="true" *ngIf="dailySummaryTblData">
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                                <ng-container i18n="@@closedSummary">Closed orders summary</ng-container>
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                        <app-day-sales-table
                                [data]="dailySummaryTblData?.data">
                        </app-day-sales-table>
                    </mat-expansion-panel>
                    <ng-container *ngFor="let tblData of byShiftSummaryTblsData">
                        <mat-expansion-panel expanded="true" *ngIf="tblData.data.length">
                            <mat-expansion-panel-header>
                                <mat-panel-title>
                                    <ng-container>{{tblData?.title}}</ng-container>
                                </mat-panel-title>
                            </mat-expansion-panel-header>
                            <app-day-sales-table
                                    [title]="tblData?.title"
                                    [data]="tblData?.data">
                            </app-day-sales-table>
                        </mat-expansion-panel>
                    </ng-container>
                </div>
            </div>
        </div>

        <app-day-sales-by-sub-department-table
                class="widget"
                [bd]="day"
                [salesBySubDepartment]="salesBySubDepartment"
        ></app-day-sales-by-sub-department-table>

        <!--Most sold items -->

        <div class="widget">
            <div class="flex d-col">
                <div class="title" i18n="@@mostSoldItems">Top Selling Items by Category</div>
                <div class="flex d-col body">
                    <mat-accordion>
                        <mat-expansion-panel expanded="false">
                            <mat-expansion-panel-header>
                                <mat-panel-title>
                                    <ng-container i18n="@@allDay">All day</ng-container>
                                </mat-panel-title>
                            </mat-expansion-panel-header>
                            <app-most-sold-items-table
                                    class="widget"
                                    [itemsData]="mostSoldItems"
                            ></app-most-sold-items-table>
                        </mat-expansion-panel>
                        <ng-container *ngFor="let tblData of mostSoldItemsByShift">
                            <mat-expansion-panel>
                                <mat-expansion-panel-header>
                                    <mat-panel-title>
                                        <ng-container>{{tblData.title}}</ng-container>
                                    </mat-panel-title>
                                </mat-expansion-panel-header>
                                <app-most-sold-items-table
                                        class="widget"
                                        [itemsData]="tblData.mostSoldItems"
                                ></app-most-sold-items-table>
                            </mat-expansion-panel>
                        </ng-container>
                    </mat-accordion>
                </div>
            </div>
        </div>

        <app-most-returned-items-table
                class="widget"
                [itemsData]="mostReturnedItems"
        ></app-most-returned-items-table>

        <!-- TODO US missing measures -->
        <app-payments-table
                class="widget"
                [bd]="day"
                [paymentsData]="paymentsData"
        ></app-payments-table>

        <app-operational-errors-table *ngIf="operationalErrorsData"
                class="widget"
                [operationalErrorsData]="operationalErrorsData"
                [lastViewed]="drilledOrderNumber"
                (onOrderClicked)="onOrderClicked_orderNumber($event)"
        ></app-operational-errors-table>

        <app-retention-table *ngIf="retentionData"
                class="widget"
                [retentionData]="retentionData"
                [lastViewed]="drilledOrderNumber"
                (onOrderClicked)="onOrderClicked_orderNumber($event)"
        ></app-retention-table>

        <app-month-summary-table *ngIf="mtdBusinessData"
                class="widget"
                [month]="day"
                [mtdBusinessData]="mtdBusinessData"
        ></app-month-summary-table>
    </div>
</div>
<div class="flex d-col drill" *ngIf="drill">
    <app-order-view style="width:100%;" [orderNumber]="drilledOrderNumber" [order]="drilledOrder"
                    [orders]="orders"></app-order-view>
</div>

